
<style>
    img, svg {
    vertical-align: middle;
    max-height: 80px;
}
.color{
    padding: 8px;
    
    cursor: pointer;
}
.color:hover{
   
}
body{
 

}
 @* my css update  *@
.navbar{
    background: linear-gradient(45deg, #007bff, skyblue);
    border-radius: 10px !important;
}

 body {
   /* background: linear-gradient(145deg, #ccc, #ccc);*/
    /*background-color:gray ;*/
}

.sales{
       border-radius: 10px;
       box-shadow: 1px 1px 6px 1px black !important;
       
}
.card{
    margin-bottom: 35px;
    box-shadow: 0 0 10px 2px;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif
}
.card .content{
    padding: 0px !important;
}
 .content .details{
   /*background: linear-gradient(to right, #28a, transparent)!important;
   background-color: #fff;
   box-shadow: 1px 1px 6px 1px black !important;
    border-radius: 6px !important;
    */
}
.disapled{
    display: none;
}
#EmployeesStatus
{
    /*background-color: white;*/
}

</style>
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" />
  
 <br>

<div class="container-fluid">
    <div class="row">
        <div class="col-sm-6 col-md-6 col-lg-3" >
            <div  class="card color card-rounded" style="background-color:#FFdd00" >
                <div class="content">
                    <div class="row">
                        <div class="col-sm-4">
                            <div class="icon-big text-center">
                                <!--i class="teal data-feather-big" stroke-width="3" data-feather="shopping-cart"></i>-->
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512">
                                <path d="M184 88C184 118.9 158.9 144 128 144C97.07 144 72 118.9 72 88C72 57.07 97.07 32 128 32C158.9 32 184 57.07 184 88zM208.4 196.3C178.7 222.7 160 261.2 160 304C160 338.3 171.1 369.8 192 394.5V416C192 433.7 177.7 448 160 448H96C78.33 448 64 433.7 64 416V389.2C26.16 371.2 0 332.7 0 288C0 226.1 50.14 176 112 176H144C167.1 176 190.2 183.5 208.4 196.3V196.3zM64 245.7C54.04 256.9 48 271.8 48 288C48 304.2 54.04 319.1 64 330.3V245.7zM448 416V394.5C468 369.8 480 338.3 480 304C480 261.2 461.3 222.7 431.6 196.3C449.8 183.5 472 176 496 176H528C589.9 176 640 226.1 640 288C640 332.7 613.8 371.2 576 389.2V416C576 433.7 561.7 448 544 448H480C462.3 448 448 433.7 448 416zM576 330.3C585.1 319.1 592 304.2 592 288C592 271.8 585.1 256.9 576 245.7V330.3zM568 88C568 118.9 542.9 144 512 144C481.1 144 456 118.9 456 88C456 57.07 481.1 32 512 32C542.9 32 568 57.07 568 88zM256 96C256 60.65 284.7 32 320 32C355.3 32 384 60.65 384 96C384 131.3 355.3 160 320 160C284.7 160 256 131.3 256 96zM448 304C448 348.7 421.8 387.2 384 405.2V448C384 465.7 369.7 480 352 480H288C270.3 480 256 465.7 256 448V405.2C218.2 387.2 192 348.7 192 304C192 242.1 242.1 192 304 192H336C397.9 192 448 242.1 448 304zM256 346.3V261.7C246 272.9 240 287.8 240 304C240 320.2 246 335.1 256 346.3zM384 261.7V346.3C393.1 335 400 320.2 400 304C400 287.8 393.1 272.9 384 261.7z" /></svg>
                            </div>
                        </div>
                        <div class="col-sm-8">
                            <div class="detail">
                                <p class="detail-subtitle">العمال</p>
                                <span id ="emp_count"class="number"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-sm-6 col-md-6 col-lg-3" data-anijs="if: scroll, on: window, do: rotateIn animated, before: scrollReveal, after: removeAnim">
            <div class="card color card-rounded" style="background-color:#ef5350">
                <div class="content">
                    <div class="row">
                        <div class="col-sm-4">
                            <div class="icon-big text-center">
                                <!--i class="teal data-feather-big" stroke-width="3" data-feather="shopping-cart"></i-->
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">
                                    <!--! Font Awesome Pro 6.1.2 by  https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M336 0C362.5 0 384 21.49 384 48V464C384 490.5 362.5 512 336 512H240V432C240 405.5 218.5 384 192 384C165.5 384 144 405.5 144 432V512H48C21.49 512 0 490.5 0 464V48C0 21.49 21.49 0 48 0H336zM64 272C64 280.8 71.16 288 80 288H112C120.8 288 128 280.8 128 272V240C128 231.2 120.8 224 112 224H80C71.16 224 64 231.2 64 240V272zM176 224C167.2 224 160 231.2 160 240V272C160 280.8 167.2 288 176 288H208C216.8 288 224 280.8 224 272V240C224 231.2 216.8 224 208 224H176zM256 272C256 280.8 263.2 288 272 288H304C312.8 288 320 280.8 320 272V240C320 231.2 312.8 224 304 224H272C263.2 224 256 231.2 256 240V272zM80 96C71.16 96 64 103.2 64 112V144C64 152.8 71.16 160 80 160H112C120.8 160 128 152.8 128 144V112C128 103.2 120.8 96 112 96H80zM160 144C160 152.8 167.2 160 176 160H208C216.8 160 224 152.8 224 144V112C224 103.2 216.8 96 208 96H176C167.2 96 160 103.2 160 112V144zM272 96C263.2 96 256 103.2 256 112V144C256 152.8 263.2 160 272 160H304C312.8 160 320 152.8 320 144V112C320 103.2 312.8 96 304 96H272z" />
                                </svg>
                            </div>
                        </div>
                        <div class="col-sm-8">
                            <div class="detail">
                                <p class="detail-subtitle">الاقسام</p>
                                <span id="dept_count" class="number"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-sm-6 col-md-6 col-lg-3" data-anijs="if: scroll, on: window, do: rotateIn animated, before: scrollReveal, after: removeAnim">
            <div class="card color card-rounded" style="background-color:#98ee9c;">
                <div class="content">
                    <div class="row">
                        <div class="col-sm-4">
                            <div class="icon-big text-center">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
                                    <!--! Font Awesome Pro 6.1.2 by - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M368 344h96c13.25 0 24-10.75 24-24s-10.75-24-24-24h-96c-13.25 0-24 10.75-24 24S354.8 344 368 344zM208 320c35.35 0 64-28.65 64-64c0-35.35-28.65-64-64-64s-64 28.65-64 64C144 291.3 172.7 320 208 320zM512 32H64C28.65 32 0 60.65 0 96v320c0 35.35 28.65 64 64 64h448c35.35 0 64-28.65 64-64V96C576 60.65 547.3 32 512 32zM528 416c0 8.822-7.178 16-16 16h-192c0-44.18-35.82-80-80-80h-64C131.8 352 96 387.8 96 432H64c-8.822 0-16-7.178-16-16V160h480V416zM368 264h96c13.25 0 24-10.75 24-24s-10.75-24-24-24h-96c-13.25 0-24 10.75-24 24S354.8 264 368 264z" />
                                </svg>
                            </div>
                        </div>
                        <div class="col-sm-8">
                            <div class="detail">
                                <p class="detail-subtitle">مستخدمين</p>
                                <span id="user_count" class="number"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-sm-6 col-md-6 col-lg-3 anyotherclass" > 
            <div class="card color card-rounded" style="background-color:#26cbda" >
                <div class="content">
                    <div class="row">
                        <div class="col-sm-4">
                            <div class="icon-big text-center">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                                <!--! Font Awesome Pro 6.1.2 by  - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M256.1 246c-13.25 0-23.1 10.75-23.1 23.1c1.125 72.25-8.124 141.9-27.75 211.5C201.7 491.3 206.6 512 227.5 512c10.5 0 20.12-6.875 23.12-17.5c13.5-47.87 30.1-125.4 29.5-224.5C280.1 256.8 269.4 246 256.1 246zM255.2 164.3C193.1 164.1 151.2 211.3 152.1 265.4c.75 47.87-3.75 95.87-13.37 142.5c-2.75 12.1 5.624 25.62 18.62 28.37c12.1 2.625 25.62-5.625 28.37-18.62c10.37-50.12 15.12-101.6 14.37-152.1C199.7 238.6 219.1 212.1 254.5 212.3c31.37 .5 57.24 25.37 57.62 55.5c.8749 47.1-2.75 96.25-10.62 143.5c-2.125 12.1 6.749 25.37 19.87 27.62c19.87 3.25 26.75-15.12 27.5-19.87c8.249-49.1 12.12-101.1 11.25-151.1C359.2 211.1 312.2 165.1 255.2 164.3zM144.6 144.5C134.2 136.1 119.2 137.6 110.7 147.9C85.25 179.4 71.38 219.3 72 259.9c.6249 37.62-2.375 75.37-8.999 112.1c-2.375 12.1 6.249 25.5 19.25 27.87c20.12 3.5 27.12-14.87 27.1-19.37c7.124-39.87 10.5-80.62 9.749-121.4C119.6 229.3 129.2 201.3 147.1 178.3C156.4 167.9 154.9 152.9 144.6 144.5zM253.1 82.14C238.6 81.77 223.1 83.52 208.2 87.14c-12.87 2.1-20.87 15.1-17.87 28.87c3.125 12.87 15.1 20.75 28.1 17.75C230.4 131.3 241.7 130 253.4 130.1c75.37 1.125 137.6 61.5 138.9 134.6c.5 37.87-1.375 75.1-5.624 113.6c-1.5 13.12 7.999 24.1 21.12 26.5c16.75 1.1 25.5-11.87 26.5-21.12c4.625-39.75 6.624-79.75 5.999-119.7C438.6 165.3 355.1 83.64 253.1 82.14zM506.1 203.6c-2.875-12.1-15.51-21.25-28.63-18.38c-12.1 2.875-21.12 15.75-18.25 28.62c4.75 21.5 4.875 37.5 4.75 61.62c-.1249 13.25 10.5 24.12 23.75 24.25c13.12 0 24.12-10.62 24.25-23.87C512.1 253.8 512.3 231.8 506.1 203.6zM465.1 112.9c-48.75-69.37-128.4-111.7-213.3-112.9c-69.74-.875-134.2 24.84-182.2 72.96c-46.37 46.37-71.34 108-70.34 173.6l-.125 21.5C-.3651 281.4 10.01 292.4 23.26 292.8C23.51 292.9 23.76 292.9 24.01 292.9c12.1 0 23.62-10.37 23.1-23.37l.125-23.62C47.38 193.4 67.25 144 104.4 106.9c38.87-38.75 91.37-59.62 147.7-58.87c69.37 .1 134.7 35.62 174.6 92.37c7.624 10.87 22.5 13.5 33.37 5.875C470.1 138.6 473.6 123.8 465.1 112.9z" /></svg>
                            </div>
                        </div>
                        <div class="col-sm-8">
                            <div class="detail">
                                <p class="detail-subtitle">ماكينات البصمة</p>
                                <span id="mac_count" class="number"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>        
    </div>
    

</div>
<div class="canvas-wrapper">
    <div class="row">
        <div class="col-md-12">
            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="content">
                            <div class="detail details" style="background-color:#c235c2d5;">
                                <p class="detail-subtitle" style="font-size: 31px;font-weight: 700;padding-top: 24px;">عدد المتواجدين حاليا</p>
                                <span id="attendId" class="number" style="font-size:100px"></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="content">                        
							<div class="detail details" style="background-color:#78a5e7">
                                <p class="detail-subtitle" style="font-size: 31px;font-weight: 700;padding-top: 24px;">عدد الحضور امس</p>
                                <span id="attendYesterdayId" class="number" style="font-size:100px"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-6">
            <div class="card card-rounded" >
              <div class="card-header" style="font-size: 31px;font-weight: 700;padding-top: 24px;">متوسط اعمار العمال</div>
              <div class="card-body">
                  <div id="avg_ages" style="font-size:100px"></div>
              </div>
            </div>
        </div>
         <div class="col-6">
            <div class="card card-rounded">
              <div class="card-header" style="font-size: 31px;font-weight: 700;padding-top: 24px;">متوسط سنوات العمل</div>
              <div class="card-body">
                  <div id="avg_years" style="font-size:100px"></div>
              </div>
            </div>
        </div>
    </div>
    <div class="row">
         <div class="col-6">
            <div class="card card-rounded">
              <div class="card-header" style="font-size: 31px;font-weight: 700;padding-top: 24px;">متوسط بقاء العمال</div>
              <div class="card-body">
                  <div id="avg_emps_years" style="font-size:100px"></div>
              </div>
            </div>
        </div>
         <div class="col-6">
            <div class="card card-rounded">
              <div class="card-header" style="font-size: 31px;font-weight: 700;padding-top: 24px;">معدل تدوبر العمال</div>
              <div class="card-body">
                  <div id="emp_change_rate" style="font-size:100px"></div>
              </div>
            </div>
        </div>
    </div>


    <div class="row">
        <div class="col-md-12">
            <div class="row">
                <div class="col-md-6 col-sm-12">
                    <div class="card">
                        <div class="content">
                            <canvas class="" id="EmployeesStatus"  ></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 ">
                    <div class="card">
                        <div class="content">                        
							<div class="detail" style="background-color:violet">
                                 <canvas class="" id="EmployeesStatus"  ></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="row">
                <div class="col-md-12">
                    <div class="card">
                        <div class="content">                   
                            <canvas class="sales" id="sales" width="250" height="250"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="row">
                <div class="col-md-12">
                    <div  class="anyotherclass" data-anijs="if: scroll, on: window, do: rotateIn animated, before: scrollReveal, after: removeAnim">
                    <div class="card">
                        <!--div class="card-header saless">in - out</div-->
                        <div class="content">
                            <canvas class="sales" id="in_out" width="500" height="250"></canvas>
                        </div>
                    </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
 </div>
    <!--div id="test" style="border:1px green solid;">SSSSS</div-->
    <script>
var pieOptions = {
  title: {
			display: true,
			text: 'العمال'
		},
  events: false,
  animation: {
    duration: 500,
    easing: "easeOutQuart",
    onComplete: function () {
      var ctx = this.chart.ctx;
      ctx.font = Chart.helpers.fontString("25", "Bold", Chart.defaults.global.defaultFontFamily);
      ctx.textAlign = 'center';
      ctx.textBaseline = 'bottom';

      this.data.datasets.forEach(function (dataset) {

        for (var i = 0; i < dataset.data.length; i++) {
          var model = dataset._meta[Object.keys(dataset._meta)[0]].data[i]._model,
              total = dataset._meta[Object.keys(dataset._meta)[0]].total,
              mid_radius = model.innerRadius + (model.outerRadius - model.innerRadius)/2,
              start_angle = model.startAngle,
              end_angle = model.endAngle,
              mid_angle = start_angle + (end_angle - start_angle)/2;

          var x = mid_radius * Math.cos(mid_angle);
          var y = mid_radius * Math.sin(mid_angle);

          ctx.fillStyle = '#111';
          if (i == 3){ // Darker text color for lighter background
            ctx.fillStyle = '#444';
          }

          var val = dataset.data[i];
          var percent = String(Math.round(val/total*100)) + "%";

          if(val != 0) {
            ctx.fillText(dataset.data[i], model.x + x, model.y + y);
            // Display percent in another line, line break doesn't work for fillText
            ctx.fillText(percent, model.x + x, model.y + y + 25);
          }
        }
      });               
    }
  }
};
var sql1=`select
	   case when StatusId is null then 'غير معلوم'
	        when StatusId =1 then 'الحالي'
		    when StatusId =2 then 'المنقطع'
		    when StatusId =3 then 'المستقيل'
	   end 'state',
	   count(*)cnt
from Employees E
                 left join Personals P on e.PersonalId=p.Id
                 left join Generals g on e.GeneralId=g.id
group by
     StatusId
     order by cnt desc`;
 
var data1 = readSQL(sql1);
		var xdata1 = [];
		var ydata1 = [];
		for (var i = 0; i < data1.length; i++) {
			xdata1.push(Object.values(data1[i])[0]);
			ydata1.push(Object.values(data1[i])[1]);
		}
var myChart2 = new Chart(document.getElementById("EmployeesStatus"), {
			type: 'doughnut',
			data: {
				labels: xdata1,
				datasets: [{
					label: "اعداد العمال",
					backgroundColor: ["#3cba9f", "#e20a0a", "yellow",
							 "#0f00f5"],
					data: ydata1
				}]
			},
           
		    //options: pieOptions
		});
            
       

var sql2= `select d.Name,
            count(*)cnt
            from Employees E left join Departements d on e.DepartementId=d.Id
            left join Personals P on e.PersonalId=p.Id
            left join Generals g on e.GeneralId=g.id
            where StatusId =1 and d.[group]=0 --and e.DepartementId<1008
            group by  d.Name`;
            
                var data2 = readSQL(sql2);
                var xdata2 = [];
                var ydata2 = [];
                for (var i = 0; i < data2.length; i++) {
                    xdata2.push(Object.values(data2[i])[0]);
                    ydata2.push(Object.values(data2[i])[1]);
                }
 var myChart2 = new Chart(document.getElementById("sales"), {//خاصة باعداد العمال 
                    type: 'bar',
                    data: {
                        labels: xdata2 ,
                        datasets: [{
                            label: 'الاقسام',
                            //backgroundColor: "rgba(76, 175, 80, 0.5)",
                            //borderColor: "rgba(76, 175, 80, 0.5)",
                            //borderWidth: 1,
                            //borderRadius: "25",
                            data: ydata2,
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        title: {
                            display: true,
                            text: 'Chart'
                        },
                        legend: {
                            position: 'top',
                            display: true,
                        },
                        tooltips: {
                            mode: 'index',
                            intersect: false,
                        },
                        hover: {
                            mode: 'nearest',
                            intersect: true
                        },
                        scales: {
                            xAxes: [{
                                display: true,
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Months'
                                }
                            }],
                            yAxes: [{
                                display: true,
                                scaleLabel: {
                                    display: true,
                                    labelString: 'عدد العمال'
                                }
                            }]
                        }
                    }
                });
           

var data = {
    datasets: [{
        data: [
            11,
            16,
            7,
            3,
            14
        ],
        backgroundColor: [
            "#FF6384",
            "#4BC0C0",
            "#FFCE56",
            "#E7E9ED",
            "#36A2EB"
        ],
        label: 'My dataset' // for legend
    }],
    labels: [
        "Red",
        "Green",
        "Yellow",
        "Grey",
        "Blue"
    ]
};

var pieOptions = {
   responsive: true,
		title: {
			display: true,
			text: 'Chart'
		},
		legend: {
			position: 'top',
			display: true,
		},
		tooltips: {
			mode: 'index',
			intersect: false,
		},
		hover: {
			mode: 'nearest',
			intersect: false
		},
		
  events: false,
  animation: {
    duration: 500,
    easing: "easeOutQuart",
    onComplete: function () {
      var ctx = this.chart.ctx;
      ctx.font = Chart.helpers.fontString(Chart.defaults.global.defaultFontFamily, 'normal', Chart.defaults.global.defaultFontFamily);
      ctx.textAlign = 'center';
      ctx.textBaseline = 'bottom';

      this.data.datasets.forEach(function (dataset) {

        for (var i = 0; i < dataset.data.length; i++) {
          var model = dataset._meta[Object.keys(dataset._meta)[0]].data[i]._model,
              total = dataset._meta[Object.keys(dataset._meta)[0]].total,
              mid_radius = model.innerRadius + (model.outerRadius - model.innerRadius)/2,
              start_angle = model.startAngle,
              end_angle = model.endAngle,
              mid_angle = start_angle + (end_angle - start_angle)/2;

          var x = mid_radius * Math.cos(mid_angle);
          var y = mid_radius * Math.sin(mid_angle);

          ctx.fillStyle = '#fff';
          if (i == 3){ // Darker text color for lighter background
            ctx.fillStyle = '#444';
          }

          var val = dataset.data[i];
          var percent = String(Math.round(val/total*100)) + "%";

          if(val != 0) {
            ctx.fillText(dataset.data[i], model.x + x, model.y + y);
            // Display percent in another line, line break doesn't work for fillText
            ctx.fillText(percent, model.x + x, model.y + y + 15);
          }
        }
      });               
    }
  }
};

var pieChartCanvas = $("#pieChart");
var pieChart = new Chart(pieChartCanvas, {
  type: 'doughnut', // or doughnut
  data: data,
  options: {
        indexAxis: 'y'
    }
});
    </script>


<script>
    fetch("/home/dashboard")
        .then((response) => response.json())
        .then((data) => 
            redraw(JSON.parse(data))
            );
    function redraw(data) {
        let emp_count = 0,
            dept_count = 0,
            user_count = 0,
            mac_count = 0;
        $.each(data, function (key, item) {
            switch (item.name) {
                case "emp":emp_count =item.cnt; break;
                case "depts":dept_count =item.cnt;  break;
                case "users":user_count =item.cnt;  break;
                case "mac": mac_count = item.cnt; break;
                default: break;
            }
        })
        var max = Math.max(emp_count,dept_count ,user_count,mac_count);
        var temp = 0;
        var i = setInterval(function () {
            temp=1+(2*temp);
            if (temp <= emp_count) $("#emp_count").html(temp); else $("#emp_count").html(emp_count);
            if (temp <= dept_count) $("#dept_count").html(temp); else $("#dept_count").html(dept_count);
            if (temp <= user_count) $("#user_count").html(temp);else $("#user_count").html(user_count);
            if (temp <= mac_count) $("#mac_count").html(temp);else $("#mac_count").html(mac_count);
           if (temp > max) { clearInterval(i); }
        }, 100);
        
    }
</script>
<script>
sql3="select count(*) as cnt from Attendances a where a.TimeFrom IS NOT NULL AND a.TimeTo IS NOT NULL AND cast(DateFrom as date)=cast(GETDATE() as date) and TimeTo=''";
$("#attendId").html(readSQL(sql3)[0].cnt);
$("#attendYesterdayId").html(readSQL("select count(*) as cnt from Attendances a where a.TimeFrom IS NOT NULL AND a.TimeTo IS NOT NULL  AND cast(DateFrom as date)=cast(dateadd(day,-1,GETDATE()) as date)")[0].cnt);
</script>
<script>
    sqlInOut = `select * from join_term order by  yer,mon
`;

    console.log(sqlInOut)   
    var jsonfile = readSQL(sqlInOut);
    console.log(jsonfile)  
    var labels = jsonfile.map(function (e) {
        return e.mon;
    });
    var data = jsonfile.map(function (e) {
        return e.cnt;
    });
    var data2 = jsonfile.map(function (e) {
        return e.cnt2;
    });
    //var ctx = canvas.getContext('in_out');
    var config = {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [
            {
                label: 'مستجد',
                data: data,
                backgroundColor: 'rgba(0, 255, 105, 0.7)'
            },
            {
                label: 'تارك العمل',
                data: data2,
                backgroundColor: 'rgba(254, 19, 0, 0.7)'
            }
            ]
        }
    };

    var chart = new Chart(document.getElementById("in_out"), config);
    
    $(window).scroll(function(){
        
    });
    var avg=readSQL(`
     select sum(datediff(day,DateOfBirth,getdate())/365.25)/count(*) avg_ages,sum(datediff(day,JoiningDate,getdate())/365.25)/count(*) avg_years
 from Employees emp join personals  per on per.id=emp.PersonalId
                    join Finances fin on fin.id=emp.FinanceId
                    join Administrations adm on adm.id=emp.AdministrationId	
                    join Addresses adr on adr.id=emp.AddressId	
                    join Generals gen on gen.id=emp.GeneralId
where per.StatusId=1 and  DepartementId<>351 --and groups=0
    `);

    $("#avg_ages").html(avg[0].avg_ages.toFixed(2))
    $("#avg_years").html(avg[0].avg_years.toFixed(2))
    const empChangeRate=readSQL(`
declare @@d date=cast(DATEPART(year, getdate()) as varchar(4))+'-01-01'
select(select count(*) from 
(select	e.FileNumber,p.JoiningDate,g.TerminationDate ,p.StatusId,
		case
			when p.StatusId=1 then 'inside'
			when p.JoiningDate>g.TerminationDate then 'inside'
			when p.JoiningDate<=g.TerminationDate then 'outside'
			else 'undefined'
		end statu
from	employees e join 
		personals p on e.PersonalId=p.id join 
		generals g on e.GeneralId=g.Id
where	(p.JoiningDate<@@d and g.TerminationDate between @@d and cast(DATEPART(year, getdate()) as varchar(4))+'-12-31') 

)q
)*100/
(select count(*)cntAll from 
(select	e.FileNumber,p.JoiningDate,g.TerminationDate ,p.StatusId,
		case
			when p.StatusId=1 then 'inside'
			when p.JoiningDate>g.TerminationDate then 'inside'
			when p.JoiningDate<=g.TerminationDate then 'outside'
			else 'undefined'
		end statu
from	employees e join 
		personals p on e.PersonalId=p.id join 
		generals g on e.GeneralId=g.Id
where	(p.JoiningDate is not null) 

)q
where (q.statu<>'undefined' and StatusId=1  and @@d > q.JoiningDate )
     or(q.statu<>'undefined' and StatusId<>1 and @@d between q.JoiningDate and q.TerminationDate )
) 'percent'		
    `);
$("#emp_change_rate").html(empChangeRate[0].percent.toFixed(2)+'%')
let avg_emps_years=readSQL(`
select  FileNumber,
		p.JoiningDate,isnull(g.TerminationDate,getdate()) TerminationDate ,
datediff(MINUTE,p.JoiningDate,isnull(g.TerminationDate,getdate())) diff 
from Employees e left join 
	 Personals p on e.PersonalId =p.id  left join 
	 Generals g on e.GeneralId=g.Id
	 where  not(TerminationDate is null and StatusId<>1) and 
			not(TerminationDate is null and StatusId=1)
`)
let sum = 0;

// calculate sum using forEach() method
avg_emps_years.forEach( num => {
  sum += num.diff;
})

//console.log() 

$("#avg_emps_years").html((sum/60/24/avg_emps_years.length).toFixed(0) )

</script>
